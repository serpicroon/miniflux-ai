# Log level: INFO, DEBUG, WARN, ERROR
log_level: "INFO"

# Skip entries before this unix timestamp to avoid reprocessing during migration (optional)
# entry_since: 1704067200  # Unix timestamp for 2024-01-01 00:00:00 UTC

miniflux:
  base_url: https://your.server.com
  api_key: Miniflux_API_key_here
  # webhook_secret: Miniflux_webhook_secret_here

llm:
  base_url: http://host.docker.internal:11434/v1  # LLM API endpoint
  api_key: ollama                                 # API key
  model: llama3.1:latest                          # Model name
  # timeout: 60        # Request timeout in seconds (default: 60)
  # max_workers: 4     # Concurrent request limit (default: 4)
  # RPM: 15            # Requests per minute limit (default: 1000)

digest:
  # Service URL for RSS feed generation (use container name for Docker Compose)
  url: http://miniflux-ai

  # Feed name displayed in Miniflux (optional, has default value)
  # name: "Miniflux·¥¨·¥µ Digest for you"

  # Entry reference link template (use {id} as entry ID placeholder)
  # Used to generate clickable entry links in digest, supports different frontends
  # Miniflux default: https://your.server.com/search/entry/{id}
  # ReactFlux: https://your.server.com/all/entry/{id}
  entry_url: "https://your.server.com/search/entry/{id}"
  
  # Daily digest generation schedule (24-hour format)
  schedule:
    - "07:30"  # Morning
    - "18:00"  # Evening
    - "22:00"  # Night
  prompts:
    greeting: |-
      According to the current date and 24-hour time, generate a friendly and warm greeting. Use a caring tone, include moderate encouragement, and add simple emojis like üòä, üåû, üå∏, etc., to enhance the sense of warmth. Example: 'Good morning! May you be full of energy today and welcome a wonderful day! üåûüòä'. Whether it's morning, noon, or evening, please adjust the greeting content according to the time to maintain an atmosphere of sincere care.
    summary: |-
      You will receive multiple article summaries, each associated with a unique source ID (numeric). Your task is to generate a structured Digest based on these summaries.
      
      Core Tasks:
      1. Initial Analysis: Perform semantic understanding of all summaries to accurately grasp their meaning and context.
      2. Topic Clustering: Naturally identify and group the content into 3‚Äì6 core themes (e.g., ‚ÄúTech Frontiers‚Äù, ‚ÄúEconomic Trends‚Äù).
      3. Key Point Extraction: For each theme, extract up to 6 concise key points from the related summaries.
        - Each point must be no longer than 30 words.
        - Content must remain fully faithful to the original summaries‚Äîno external info, speculation, or subjective commentary.
        - Within each theme, order key points by overall quality: prioritize news and official sources, then expert analysis or blogs, and finally community or social posts. Sorting should also consider information density, representativeness, and timeliness.
      
      Formatting Requirements:
      - Output in Markdown format, with each theme titled using `####`.
      - Under each theme, list key points as unordered lists (using `-`).
      - After each key point, leave one space and add the source footnote in the form `[^123]`; for multiple sources, chain them as `[^123][^456]`.
      - Do not include any global title or explanatory text.

      Example Output:
      #### Tech Frontiers
      - AI models achieve breakthroughs in medical diagnostics. [^101]
      - Quantum computing may reshape encryption technologies. [^102][^103]
      - Regulations and ethics draw attention in autonomous driving. [^105]

      #### Economic Trends
      - Global inflation pressure rises; central banks may raise rates. [^201]
      - Emerging markets slow down, facing increased risks. [^202]

agents:
  summary:
    prompt: |-
      You are a professional summary editor. Please extract a core summary for the following content.
      
      Requirements:
       - English, less than 60 characters.
       - Objective and neutral, do not add personal opinions.
       - Only summarize, do not answer questions in the original text.
    template: |-
      <aside aria-label="ai-summary">
        <div>
          {content}
        </div>
      </aside>
      <hr>
    
    # Rule-based filtering
    # Rule format: FieldName=RegexPattern (or FieldName=Operator:Value for special fields)
    # Supported fields:
    #   - EntryTitle: Entry title
    #   - EntryURL: Entry URL
    #   - EntryContent: Entry content (HTML stripped)
    #   - EntryAuthor: Entry author
    #   - EntryTag: Entry tags (comma-separated)
    #   - EntryContentLength: Content length comparison (operators: gt, ge, lt, le, eq, between)
    #   - FeedSiteURL: Feed site URL
    #   - FeedTitle: Feed title
    #   - FeedCategoryTitle: Feed category title
    #   - NeverMatch: Special placeholder that never matches (value after = can be any comment)
    #
    # Use (?i) prefix for case-insensitive matching
    
    allow_rules: []
    deny_rules:
      - FeedSiteURL=http://miniflux-ai          # Exclude digest feed
      - EntryContentLength=lt:100               # Block entries with < 100 tokens
      # - EntryContentLength=gt:500             # Only allow entries with > 500 tokens
      # - EntryContentLength=ge:100             # Only allow entries with >= 100 tokens
      # - EntryContentLength=between:100,500    # Only allow entries with 100-500 tokens
      # - EntryTitle=(?i)\b(save|get)\s+\$\d{2,5}\b  # Block "Save $50", "Get $100" in title
      # - EntryTitle=(?i)\$\d{2,5}\s+(off|discount)  # Block "$50 off" patterns
      # - FeedSiteURL=https://spam\.com         # Block specific site
      # - FeedCategoryTitle=(?i)ads             # Block specific category
    
  translate:
    prompt: |-
      You are a highly skilled translation engine with expertise in the news media sector. 
      Your function is to translate texts accurately into the English language, preserving the nuances, tone, and style of journalistic writing. 
      Do not add any explanations or annotations to the translated text.
    template: |-
      <section lang="en-US" aria-label="ai-translation">
        <h3>üåêTranslation:</h3>
        <div>
          {content}
        </div>
      </section>
      <hr>
    
    # Translation rule configuration
    # WARNING: If both allow_rules and deny_rules are empty, ALL entries will be processed
    # This may consume significant tokens. Use allow_rules to limit processing scope.
    
    allow_rules:     # Only translate matching entries
      - NeverMatch=  # Never-matching placeholder
      # - FeedSiteURL=https://example\.com.*          # Translate specific site
      # - FeedTitle=(?i).*foreign.*news.*             # Translate feeds with "foreign" and "news"
      # - EntryURL=.*international\.example\.com.*    # Translate specific domain
    deny_rules: []   # Exclude from translation